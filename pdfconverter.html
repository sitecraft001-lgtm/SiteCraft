<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image to PDF | SiteCraft Tools</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

* { box-sizing: border-box; }

body {
  margin: 0;
  min-height: 100vh;
  font-family: 'Inter', system-ui;
  background: radial-gradient(1200px 600px at top, #0f172a, #020617);
  color: #e5e7eb;
  display: flex;
  align-items: center;
  justify-content: center;
}

.app {
  width: 95%;
  max-width: 520px;
  background: rgba(15, 23, 42, 0.8);
  backdrop-filter: blur(20px);
  border-radius: 24px;
  padding: 28px;
  box-shadow: 0 30px 80px rgba(0,0,0,.7);
  border: 1px solid rgba(255,255,255,.06);
}

.header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
}

.logo {
  width: 42px;
  height: 42px;
  border-radius: 12px;
  background: linear-gradient(135deg, #38bdf8, #818cf8);
  display: grid;
  place-items: center;
  font-weight: 800;
  color: #020617;
}

h1 {
  font-size: 20px;
  margin: 0;
}

.subtitle {
  font-size: 13px;
  color: #94a3b8;
}

.dropzone {
  margin-top: 20px;
  border: 2px dashed #38bdf8;
  border-radius: 18px;
  padding: 30px;
  text-align: center;
  cursor: pointer;
  transition: .3s;
}

.dropzone:hover {
  background: rgba(56,189,248,.08);
}

.dropzone.drag {
  background: rgba(56,189,248,.15);
  border-color: #818cf8;
}

.dropzone p {
  margin: 0;
  font-size: 14px;
}

.preview {
  margin-top: 18px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(90px,1fr));
  gap: 12px;
}

.preview img {
  width: 100%;
  height: 90px;
  object-fit: cover;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.08);
}

.info {
  margin-top: 10px;
  font-size: 13px;
  color: #94a3b8;
}

button {
  width: 100%;
  margin-top: 20px;
  padding: 15px;
  border-radius: 14px;
  border: none;
  font-weight: 700;
  background: linear-gradient(135deg, #38bdf8, #818cf8);
  color: #020617;
  cursor: pointer;
  font-size: 15px;
}

button:disabled {
  opacity: .5;
}

.loader {
  display: none;
  text-align: center;
  margin-top: 14px;
  font-size: 13px;
  color: #38bdf8;
}
</style>
</head>
<body>

<div class="app">
  <div class="header">
    <div class="logo">SC</div>
    <div>
      <h1>Image to PDF</h1>
      <div class="subtitle">Fast • Secure • Client Side</div>
    </div>
  </div>

  <div class="dropzone" id="dropzone">
    <p>Click or drag images here</p>
    <input type="file" id="files" multiple accept="image/*" hidden>
  </div>

  <div class="preview" id="preview"></div>
  <div class="info" id="info">No files selected</div>

  <button id="convert" disabled>Convert & Download</button>
  <div class="loader" id="loader">Converting images...</div>
</div>

<script>
const dz = document.getElementById("dropzone");
const input = document.getElementById("files");
const preview = document.getElementById("preview");
const info = document.getElementById("info");
const btn = document.getElementById("convert");
const loader = document.getElementById("loader");

let images = [];
let currentFileNumber = null; // Track current batch number

dz.onclick = () => input.click();

dz.ondragover = e => {
  e.preventDefault();
  dz.classList.add("drag");
};

dz.ondragleave = () => dz.classList.remove("drag");

dz.ondrop = e => {
  e.preventDefault();
  dz.classList.remove("drag");
  loadFiles(e.dataTransfer.files);
};

input.onchange = () => loadFiles(input.files);

function loadFiles(files) {
  images = [...files];
  preview.innerHTML = "";
  images.forEach(f => {
    const img = document.createElement("img");
    img.src = URL.createObjectURL(f);
    preview.appendChild(img);
  });
  info.textContent = images.length + " image(s) selected";
  btn.disabled = images.length === 0;
  currentFileNumber = null; // Reset number for new batch
}

btn.onclick = async () => {
  if (btn.disabled) return;
  btn.disabled = true;
  loader.style.display = "block";

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();

  for (let i = 0; i < images.length; i++) {
    const data = await toBase64(images[i]);
    const img = new Image();
    img.src = data;
    await new Promise(r => img.onload = r);

    const w = pdf.internal.pageSize.getWidth();
    const h = (img.height * w) / img.width;

    if (i > 0) pdf.addPage();
    pdf.addImage(img, "JPEG", 0, 0, w, h);
  }

  // ✅ Increment file number only once per batch
  if (currentFileNumber === null) {
    let count = localStorage.getItem("sitecraftPdfCount") || 0;
    count++;
    localStorage.setItem("sitecraftPdfCount", count);
    currentFileNumber = count;
  }

  pdf.save(`sitecraft-image-to-pdf${currentFileNumber}.pdf`);

  loader.style.display = "none";
  btn.disabled = false;
};

function toBase64(file) {
  return new Promise(res => {
    const reader = new FileReader();
    reader.onload = e => res(e.target.result);
    reader.readAsDataURL(file);
  });
}
</script>

</body>
</html>
