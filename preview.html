<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Preview</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    font-family: Arial, sans-serif;
    background: #f5f5f5;
  }

  /* Navbar */
  .navbar {
    height: 50px;
    background: #1a1d23;
    color: white;
    display: flex;
    align-items: center;
    padding: 0 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    flex-shrink: 0;
  }

  .navbar .back-btn {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
    margin-right: 15px;
  }

  .navbar .title {
    flex: 1;
    text-align: center;
    font-size: 18px;
    font-weight: bold;
  }

  /* Preview wrapper */
  #preview-wrapper {
    width: 100%;
    height: calc(100% - 50px);
    overflow: hidden;
    position: relative;
  }

  /* Scaling iframe to fit mobile perfectly */
  #preview-frame {
    border: none;
    width: 100%;
    height: 100%;
    transform-origin: 0 0;
    display: block;
  }
</style>
</head>
<body>

<div class="navbar">
  <button class="back-btn" onclick="history.back()">‚Üê</button>
  <div class="title">Preview</div>
</div>

<div id="preview-wrapper">
  <iframe id="preview-frame"></iframe>
</div>

<script>
  const iframe = document.getElementById('preview-frame');
  const p = JSON.parse(localStorage.getItem("liveProject") || '{}');

  // Construct full HTML for iframe
  const content = `
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <style>${p.css || ''}</style>
    </head>
    <body>${p.html || ''}</body>
    <script>${p.js || ''}<\/script>
    </html>
  `;

  iframe.srcdoc = content;

  // Scale iframe content to fit mobile width
  iframe.onload = () => {
    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
    const body = iframeDoc.body;
    const html = iframeDoc.documentElement;

    const updateScale = () => {
      const deviceWidth = iframe.clientWidth;
      const contentWidth = html.scrollWidth;
      const scale = deviceWidth / contentWidth;

      iframe.style.transform = `scale(${scale})`;
      iframe.style.height = `${html.scrollHeight * scale}px`;
    };

    updateScale();
    window.addEventListener('resize', updateScale);
  };
</script>

</body>
</html>
